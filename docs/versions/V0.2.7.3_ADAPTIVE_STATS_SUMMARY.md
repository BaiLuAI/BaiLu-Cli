# Bailu CLI v0.2.7.3 - 自適應統計面板更新

## 版本資訊
- **版本號**: v0.2.7.3
- **發佈日期**: 2026-01-05
- **更新類型**: Patch - 功能優化

## 更新摘要

實現了智慧型統計面板系統，根據對話複雜度自動選擇顯示精簡版或完整版統計資訊，提升使用者體驗。

## 核心改進

### 1. 新增精簡版統計面板

**新增函數**: `createCompactStatsPanel()`

```typescript
export function createCompactStatsPanel(stats: {
  totalTokensUsed: number;
  responseTime: number;
}): string
```

**用途**: 
- 簡單對話（無工具調用）時顯示
- 只顯示核心資訊：Token 使用量和響應時間
- 減少視覺干擾，保持介面簡潔

**顯示格式**:
```
┌────────────────────────────────┐
│  Token: 150  |  時間: 0.85s    │
└────────────────────────────────┘
```

### 2. 完整統計面板保留

**現有函數**: `createStatsPanel()`

**用途**:
- 複雜操作（有工具調用）時顯示
- 顯示完整統計：訊息數、工具調用次數、Token、響應時間
- 提供詳細的操作追蹤資訊

**顯示格式**:
```
┌──────────────────────────────────────────────────────────────┐
│  訊息數: 8  |  工具調用: 3  |  Token: 2450  |  響應時間: 2.34s  │
└──────────────────────────────────────────────────────────────┘
```

### 3. 智慧型顯示邏輯

**判斷依據**: `toolCallsCount > 0`

```typescript
if (this.sessionStats.toolCallsCount > 0) {
  // 有工具調用 - 顯示完整統計
  console.log(createStatsPanel({...}));
} else {
  // 簡單對話 - 顯示精簡統計
  console.log(createCompactStatsPanel({...}));
}
```

**應用位置**:
- `handleSingleLine()`: 單行輸入處理
- `processMultiLineInput()`: 多行輸入處理

## 技術細節

### 修改的檔案

#### 1. `src/utils/panel-formatter.ts`
- ✅ 新增 `createCompactStatsPanel()` 函數
- ✅ 保留原有 `createStatsPanel()` 函數
- ✅ 兩個函數使用相同的視覺風格（灰色邊框、居中對齊）

#### 2. `src/agent/chat.ts`
- ✅ 匯入 `createCompactStatsPanel`
- ✅ 在 `handleSingleLine()` 中實現智慧型顯示
- ✅ 在 `processMultiLineInput()` 中實現智慧型顯示
- ✅ 錯誤情況不顯示統計面板（維持原行為）

### 顯示場景對比

| 場景類型 | 工具調用 | 顯示面板 | 包含資訊 |
|---------|---------|---------|---------|
| 簡單問答 | ❌ 無 | 精簡版 | Token + 時間 |
| 檔案讀取 | ✅ 有 | 完整版 | 訊息數 + 工具數 + Token + 時間 |
| 程式碼編寫 | ✅ 有 | 完整版 | 完整統計資訊 |
| 命令執行 | ✅ 有 | 完整版 | 完整統計資訊 |
| 一般對話 | ❌ 無 | 精簡版 | Token + 時間 |

## 使用者體驗改善

### 優點 ✅

1. **資訊透明度**
   - 每次對話都能看到 Token 使用情況
   - 即時了解回應速度

2. **減少視覺干擾**
   - 簡單對話不顯示冗餘資訊
   - 複雜操作才展示完整統計

3. **智慧型適應**
   - 系統自動判斷顯示內容
   - 無需使用者手動配置

4. **一致性**
   - 統一的視覺風格
   - 可預測的顯示行為

### 使用場景

#### 場景 1: 簡單對話
```
使用者: 你好
AI: 您好！我是白鹿 AI 助手...

┌────────────────────────────────┐
│  Token: 45  |  時間: 0.32s     │
└────────────────────────────────┘
```

#### 場景 2: 檔案操作
```
使用者: 幫我讀取 package.json
AI: 我已經讀取了 package.json...

┌──────────────────────────────────────────────────────────────┐
│  訊息數: 4  |  工具調用: 1  |  Token: 856  |  響應時間: 1.23s  │
└──────────────────────────────────────────────────────────────┘
```

## 編譯測試

```bash
npm run build
# ✅ 編譯成功，無錯誤
```

## 版本號更新

建議將 `package.json` 版本號更新為 `0.2.7.3`

## Git Commit 建議

### 完整版（繁體中文）
```
feat: 實現自適應統計面板系統 (v0.2.7.3)

新增功能：
- 新增精簡版統計面板 createCompactStatsPanel()
- 實現智慧型顯示邏輯，根據工具調用情況自動選擇面板類型
- 簡單對話顯示精簡統計（Token + 時間）
- 複雜操作顯示完整統計（訊息數 + 工具調用 + Token + 時間）

改進：
- 減少視覺干擾，提升使用者體驗
- 保持資訊透明度，每次對話都顯示統計
- 統一視覺風格，保持介面一致性

修改檔案：
- src/utils/panel-formatter.ts: 新增精簡版統計面板
- src/agent/chat.ts: 實現智慧型顯示邏輯
- docs/versions/V0.2.7.3_ADAPTIVE_STATS_SUMMARY.md: 更新文檔

影響：
- 提升簡單對話的介面簡潔度
- 保留複雜操作的詳細追蹤
- 所有統計面板始終顯示，提供即時反饋
```

### 簡短版
```
feat: 自適應統計面板 - 根據複雜度顯示精簡/完整統計 (v0.2.7.3)

- 新增精簡版統計面板（Token + 時間）
- 智慧判斷：無工具調用顯示精簡版，有工具調用顯示完整版
- 提升 UX：減少視覺干擾，保持資訊透明
```

## 後續建議

### 可選優化
1. **配置選項**: 添加環境變數控制統計面板顯示（always/auto/never）
2. **歷史追蹤**: 在 `/stats` 命令中顯示統計趨勢圖
3. **成本估算**: 基於 Token 使用量顯示預估 API 成本

### 測試建議
1. 測試簡單對話（如「你好」）- 應顯示精簡統計
2. 測試檔案讀取 - 應顯示完整統計
3. 測試程式碼生成 - 應顯示完整統計
4. 確認錯誤情況不顯示統計面板

## 總結

v0.2.7.3 版本成功實現了自適應統計面板系統，在保持資訊透明度的同時，根據對話複雜度智慧調整顯示內容，顯著提升了使用者體驗。系統現在能夠：

- ✅ 每次對話都提供統計回饋
- ✅ 根據複雜度自動選擇適當的顯示格式
- ✅ 減少簡單對話的視覺干擾
- ✅ 保留複雜操作的詳細追蹤

此更新完美平衡了資訊豐富度與介面簡潔性，為使用者提供了更好的互動體驗。
